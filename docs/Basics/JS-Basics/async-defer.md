---
id: async-defer
title: '📜 Async and Defer'
slug: /async-defer
---

> 當外部引入 javascript 時，有時會看到 async 或是 defer，請問這兩者分別是什麼 ?

## example

這邊先透過案例說明來理解這兩者的差異

### 同步

當只有一條車道時，後方 B 車需等待前方的 A 車抵達終點，自己才能抵達。如果今天有多輛車時，很容易產生阻塞的狀況。

```javascript
// 車道 1
=============================
start   B A   =>          end
=============================
```

### 非同步(async)

所以為了解決這個問題，我們可能透過加開車道，來讓速度更快的車輛提前抵達終點，但在前進的過程中，很難判斷哪兩車的速度更快或是更穩定，換言之，即可能同時抵達，也可能每次先後抵達的車輛都不一致。

```javascript
// 車道 1 and 車道 2
====================================
start   A   =>
=============================  end
start   B   =>
====================================
```

### 推遲(defer)

所以為了解決前述的問題，透過限制特定車輛，要求必須等待特定車輛通過，才能啟動，達到控制車輛抵達順序的需求。

```javascript
====================================
start              A(waiting)
=============================  end
start   B   =>
====================================
```

## Browser

我們已經知道，當瀏覽器在解析 html 文件時，如果遇到 script 標籤，會自動先請求 js 文件，這種同步狀況，會導致原本的 html 文件解析被卡住，如果今天請求 js 文件的 sever 端網路速度不好，這會造成網站無法正常運作。

為了處理這種狀況，所以會透過 async 或 defer 來處理，讓請求 js 文件的同時，繼續解析 html，但需要注意的是，async 的解析步驟是，當 js 文件如果已成功取回，就會開始執行，即使 html 尚未解析完畢:

```javascript
====================================
HTML開始解析         HTML解析結束
===============================  end
          JS下載並執行
====================================
```

這樣很可能會導致 DOM 操作失效，顯然不是太好的解決方案。相反的，如果改採 defer:

```javascript
====================================
HTML開始解析  =>  HTML解析結束
=================================  end
      JS下載完成              JS執行
====================================
```

js 可以等待 html 解析完成後，才執行 DOM 操作，避免失效問題。

不過原則上，如果為了考慮老或冷門瀏覽器的兼容性，一般還是建議將 script 標籤放置頁尾處。
